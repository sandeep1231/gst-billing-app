services:
  - type: web
    name: gst-billing-app
    env: node
    rootDir: backend
    buildCommand: |
      npm ci
      npm run build
      cd ../frontend
      npm ci
      npm run build
      cd ..
      # copy angular build into backend/dist/public for runtime availability
      mkdir -p backend/dist/public
      cp -r frontend/dist/frontend/* backend/dist/public/
    startCommand: npm start
    autoDeploy: true
    envVars:
      - key: MONGO_URI
        sync: false
      - key: JWT_SECRET
        generateValue: true
      - key: ORIGIN
        value: https://gst-billing-app.onrender.com
      - key: NODE_VERSION
        value: 18.20.4
