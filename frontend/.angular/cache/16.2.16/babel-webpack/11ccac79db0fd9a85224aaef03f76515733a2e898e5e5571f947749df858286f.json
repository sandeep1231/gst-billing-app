{"ast":null,"code":"import { __decorate } from \"tslib\";\nimport { Component, inject } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { ReactiveFormsModule, FormBuilder, Validators } from '@angular/forms';\nimport { FormsModule } from '@angular/forms';\nimport { CustomersService } from '../../services/customers.service';\nexport let CustomersPage = class CustomersPage {\n  constructor() {\n    this.svc = inject(CustomersService);\n    this.fb = inject(FormBuilder);\n    this.items = [];\n    this.page = 1;\n    this.limit = 20;\n    this.lastCount = 0;\n    this.query = '';\n    this.formVisible = false;\n    this.saving = false;\n    this.editId = null;\n    this.form = this.fb.group({\n      name: ['', Validators.required],\n      phone: [''],\n      gstin: ['', [Validators.pattern(/^[0-9]{2}[A-Z]{5}[0-9]{4}[A-Z][0-9A-Z]Z[0-9A-Z]$/)]],\n      line1: [''],\n      city: [''],\n      pincode: ['']\n    });\n  }\n  ngOnInit() {\n    this.load();\n  }\n  load() {\n    this.svc.list(this.query, this.page, this.limit).subscribe({\n      next: data => {\n        this.items = data;\n        this.lastCount = data.length;\n      },\n      error: () => {\n        this.items = [];\n        this.lastCount = 0;\n      }\n    });\n  }\n  apply() {\n    this.page = 1;\n    this.load();\n  }\n  prev() {\n    if (this.page > 1) {\n      this.page--;\n      this.load();\n    }\n  }\n  next() {\n    if (this.lastCount >= this.limit) {\n      this.page++;\n      this.load();\n    }\n  }\n  startCreate() {\n    this.form.reset({\n      name: '',\n      phone: '',\n      gstin: '',\n      line1: '',\n      city: '',\n      pincode: ''\n    });\n    this.editId = null;\n    this.formVisible = true;\n  }\n  startEdit(c) {\n    this.form.patchValue({\n      name: c.name || '',\n      phone: c.phone || '',\n      gstin: c.gstin || '',\n      line1: c.address?.line1 || '',\n      city: c.address?.city || '',\n      pincode: c.address?.pincode || ''\n    });\n    this.editId = c._id || null;\n    this.formVisible = true;\n  }\n  cancel() {\n    this.formVisible = false;\n    this.editId = null;\n  }\n  gstinInvalid() {\n    const ctrl = this.form.get('gstin');\n    return !!ctrl && ctrl.touched && ctrl.value && ctrl.invalid;\n  }\n  upper(field) {\n    const c = this.form.get(field);\n    if (c && typeof c.value === 'string') c.setValue(c.value.toUpperCase());\n  }\n  save() {\n    if (this.form.invalid) return;\n    this.saving = true;\n    const v = this.form.value;\n    const body = {\n      name: v.name,\n      phone: v.phone || undefined,\n      gstin: (v.gstin || '').toUpperCase() || undefined,\n      address: {\n        line1: v.line1 || undefined,\n        city: v.city || undefined,\n        pincode: v.pincode || undefined\n      }\n    };\n    const req = this.editId ? this.svc.update(this.editId, body) : this.svc.create(body);\n    req.subscribe({\n      next: () => {\n        this.saving = false;\n        this.formVisible = false;\n        this.load();\n      },\n      error: () => {\n        this.saving = false;\n      }\n    });\n  }\n  remove(c) {\n    if (!c._id) return;\n    if (!confirm(`Delete customer '${c.name}'?`)) return;\n    this.svc.remove(c._id).subscribe({\n      next: () => this.load()\n    });\n  }\n};\nCustomersPage = __decorate([Component({\n  standalone: true,\n  imports: [CommonModule, ReactiveFormsModule, FormsModule],\n  template: `\n  <div class=\"d-flex align-items-center justify-content-between mb-3\">\n    <h4 class=\"mb-0\">Customers</h4>\n    <button class=\"btn btn-primary\" (click)=\"startCreate()\" *ngIf=\"!formVisible\">Add Customer</button>\n  </div>\n\n  <div class=\"card mb-3\" *ngIf=\"formVisible\">\n    <div class=\"card-body\">\n      <form [formGroup]=\"form\" (ngSubmit)=\"save()\" class=\"row g-3\">\n        <div class=\"col-md-6\">\n          <label class=\"form-label\">Name</label>\n          <input class=\"form-control\" formControlName=\"name\" />\n        </div>\n        <div class=\"col-md-3\">\n          <label class=\"form-label\">Phone</label>\n          <input class=\"form-control\" formControlName=\"phone\" />\n        </div>\n        <div class=\"col-md-3\">\n          <label class=\"form-label\">GSTIN</label>\n          <input class=\"form-control\" formControlName=\"gstin\" (blur)=\"upper('gstin')\" [class.is-invalid]=\"gstinInvalid()\" />\n          <div class=\"invalid-feedback\" *ngIf=\"gstinInvalid()\">Invalid GSTIN format</div>\n        </div>\n        <div class=\"col-md-6\">\n          <label class=\"form-label\">Address Line 1</label>\n          <input class=\"form-control\" formControlName=\"line1\" />\n        </div>\n        <div class=\"col-md-3\">\n          <label class=\"form-label\">City</label>\n          <input class=\"form-control\" formControlName=\"city\" />\n        </div>\n        <div class=\"col-md-3\">\n          <label class=\"form-label\">PIN Code</label>\n          <input class=\"form-control\" formControlName=\"pincode\" />\n        </div>\n        <div class=\"col-12 d-flex gap-2\">\n          <button class=\"btn btn-primary\" type=\"submit\" [disabled]=\"form.invalid || saving\">{{ editId ? 'Update' : 'Create' }}</button>\n          <button class=\"btn btn-outline-secondary\" type=\"button\" (click)=\"cancel()\">Cancel</button>\n        </div>\n      </form>\n    </div>\n  </div>\n\n  <form class=\"row g-2 mb-2\" (ngSubmit)=\"apply()\">\n    <div class=\"col-md-4\"><input class=\"form-control\" [(ngModel)]=\"query\" name=\"query\" placeholder=\"Search customers...\" /></div>\n    <div class=\"col-md-2 d-grid\"><button class=\"btn btn-outline-secondary\" type=\"submit\">Apply</button></div>\n  </form>\n\n  <div class=\"card\">\n    <div class=\"table-responsive\">\n      <table class=\"table table-hover align-middle mb-0\">\n        <thead class=\"table-light\">\n          <tr>\n            <th>Name</th>\n            <th>Phone</th>\n            <th>GSTIN</th>\n            <th>Address</th>\n            <th class=\"text-end\">Actions</hth>\n          </tr>\n        </thead>\n        <tbody>\n          <tr *ngFor=\"let c of items\">\n            <td>{{ c.name }}</td>\n            <td>{{ c.phone }}</td>\n            <td>{{ c.gstin }}</td>\n            <td>{{ c.address?.line1 }}<span *ngIf=\"c.address?.city\">, {{ c.address?.city }}</span> <span *ngIf=\"c.address?.pincode\">- {{ c.address?.pincode }}</span></td>\n            <td class=\"text-end\">\n              <button class=\"btn btn-sm btn-outline-primary me-2\" (click)=\"startEdit(c)\">Edit</button>\n              <button class=\"btn btn-sm btn-outline-danger\" (click)=\"remove(c)\">Delete</button>\n            </td>\n          </tr>\n          <tr *ngIf=\"items.length===0\"><td colspan=\"5\" class=\"text-center text-muted py-4\">No customers</td></tr>\n        </tbody>\n      </table>\n    </div>\n    <div class=\"card-footer d-flex align-items-center gap-2\">\n      <div class=\"me-auto text-muted\">Page {{ page }}</div>\n      <div class=\"btn-group\">\n        <button class=\"btn btn-sm btn-outline-secondary\" (click)=\"prev()\" [disabled]=\"page<=1\">Prev</button>\n        <button class=\"btn btn-sm btn-outline-secondary\" (click)=\"next()\" [disabled]=\"lastCount<limit\">Next</button>\n      </div>\n    </div>\n  </div>\n  `\n})], CustomersPage);","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}